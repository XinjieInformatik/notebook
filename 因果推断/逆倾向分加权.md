# IPW 逆倾向分加权

保留所有样本，倾向分转换为逆概率权重。
- 对于原本属于treatment组但是倾向分低的样本，说明该样本偏离treatment组整体分布，但是他是treatment作用下的样本，因此应该得到更多的关注，获得更多的损失函数加权。
- 对于原本属于control组但是倾向分低的样本，说明该样本偏离treatment组整体分布，因此应该获得更少的关注，获得更少的损失函数加权。

| 组别  | IPW              |
| ----- | ---------------- |
| T = 1 | $ \frac{1}{P} $  |
| T = 0 | $ \frac{1}{1-P}$ |


## 权重截断

倾向分处于分母，是一个敏感的位置，会导致个别样本获得很高的权重。因此可以设置一个阈值将样本权重截断。例如ipw值高于5的全部截断为5。


## 思考

1. 相比PSM倾向分匹配，逆倾向分加权可以保留全部样本，通过treatment的倾向分，对于有偏样本通过样本权重的形式，在训练过程中给予不同样本不同的权重，实现无偏样本的近似构造。
2. ipw是否合理，或者在该数据分布下是否合适是一个问题。例如：对于原本属于treatment组但是倾向分低的样本，就应该获得更大权重么？通过这种方式训练模型，满足因果推断 特征X与干预T独立，特征X与labelY独立的假设么？
3. 构造好固定的验证集，该方式还是可以同一评估一下效果。

## 参考

https://www.bmj.com/content/bmj/352/bmj.i189.full.pdf
